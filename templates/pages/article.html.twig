{% extends "base.html.twig" %}

{# 
# Set up date variables.
# Use seconds to compare date.
# This date is +1hour to UK time
# it is like Italy time
#}
{% set getDateToday = "now"|date('U') %}

{# Set up empty variable for article content #}
{% set articleTitle = '' %}
{% set articleDescription = '' %}
{% set articleUrl = '' %}
{% set articleContent = '' %}
{% set articleImage = '' %}
{% set articleImageAlt = '' %}
{% set articleDate = '' %}
{% set articleUpdate = '' %}
{% set genderOption = '' %}

{# Flags variable that helps with 404 template #}
{% set break = false %}
{% set notFound = true %}
{% for article in articles %}
    {% if slug == article.url %}
        {# Set up article variavles #}
        {% set articleTitle = article.title %}
        {% set articleDescription = article.description %}
        {% set articleUrl = article.url %}
        {% set articleContent = article.content %}
        {% set articleImage = article.getImage %}
        {% set articleImageAlt = article.getImage.title %}
        {% set articleDate = article.getDate %}
        {% set articleUpdate = article.getUpdateAt %}
        {% set genderOption = article.genderOption %}
        {% set break = true %}
        {% set notFound = false %}
    {% endif %}
{% endfor %}

{% block title %}
    {% if break == false and notFound == true %}
        <title>Marco Valeri: error 404, pagina non trovata</title>
    {% else %}
        <title>{{ articleTitle|raw }}</title>
    {% endif %}
{% endblock %}

{% block description %}
    {% if break == false and notFound == true %}
        <meta name="Description" CONTENT="Marco Valeri: Error 404, page not found">
    {% else %}
        <meta name="Description" CONTENT="{{ articleDescription|raw }}">
    {% endif %}
{% endblock %}

{% block data_structure %}
    {% if break == false and notFound == true %}
        <script type="application/ld+json">
            {
                "@context": "https://schema.org/",
                "@type": "Page",
                "headline": "Marco Valeri: error 404, pagina non trovata"
            }
        </script>
    {% else %}
        <script type="application/ld+json">
            {
                "@context": "https://schema.org/",
                "@type": "Article",
                "headline": "{{ articleTitle|raw }}"
            },
            {
                "datePublished": "{{ articleDate|date('Y-m-d') }}",
                "dateModified": "{{ articleUpdate|date('Y-m-d') }}",
                "author" {
                    "@type": "Person",
                    "name": "Marco Valeri",
                },
            }
        </script>
    {% endif %}
{% endblock %}

{% block body %}
    {# 
    # If the article url exist
    # and
    # if current date is less than article data
    # public it
    # otherwise show 404 template
    #}
    {% if (break == false and notFound == true) or (getDateToday < articleDate|date('U')) %}
        <div class="content__title">
            <h1>Articolo non trovato</h1>
        </div>
        <div class="content__main">
            <div class="error404">
                <div class="error404__content-container">
                    <p class="body-1">Sembra che l'articolo che stai cercando non esista.</p>
                    <p class="body-1">Cosa vuoi fare?</p>
                </div>
                <div class="error404__container-btns">
                    <a class="error404__btn button no-link--white" href="{{ path('app_home') }}">Home</a>
                    <a class="error404__btn button no-link--white" href="{{ path('app_home') }}">Articoli</a>
                    <a class="error404__btn button no-link--white" href="{{ path('app_contact') }}">Contatti</a>
                </div>
            </div>
        </div>
    {% else %}
        <div class="content__title">
            <h1>{{ articleTitle }}</h1>
        </div>
        <div class="content__data">
            <ul class="list-no-style">
                <li class="content__data-item">Autore: Marco Valeri</li>
                <li class="content__data-item">Pubblicato il: {{ articleDate|date('d-m-Y') }}</li>
                <li class="content__data-item">Ultima modifica: {{ articleUpdate|date('d-m-Y') }}</li>
            </ul>
        </div>
        {% if genderOption %}
            <div class="content__gender-banner">
            <p id="gender-legend" class="p rainbow">Sentiti libero...</p>
                <ul class="list-no-style">
                    <li class="content__gender-item"><img id="gender-male" class="content__gender-icon content__gender-icon--active" src="../images/male-icon.png" alt="Male Simbol Icon"></li>
                    <li class="content__gender-item"><img id="gender-female" class="content__gender-icon" src="../images/female-icon.png" alt="Male Simbol Icon"></li>
                    <li class="content__gender-item"><img id="gender-non-binary" class="content__gender-icon" src="../images/non-binary-icon.png" alt="Male Simbol Icon"></li>
                </ul>
                <p class="p rainbow">...di scegliere il linguaggio che preferisci</p>
            </div>
        {% endif %}
        <div class="content__main">
            {{ articleContent | raw }}
        </div>
        <div class="content__image">
            <img class="content__image-picture" src="../images/{{ articleImage }}" alt="{{ articleImageAlt }}">
        </div>
        <div class="content__container-comment-form">
            {{ form_start(formComment) }}
                <div class="content__comment-form-grid">
                    <div class="content__form-grid-name">
                        {{ form_row(formComment.name, {'attr': {'class': 'content__form-input-name'}}) }}
                    </div>
                    <div class="content__form-grid-email">
                        {{ form_row(formComment.email, {'attr': {'class': 'content__form-input-email'}}) }}
                    </div>
                    <div class="content__form-grid-comment">
                        {{ form_row(formComment.content, {'attr': {'class': 'content__form-input-comment'}}) }}
                    </div>
                    <div class="content__form-comments-privacy">
                        {{ form_widget(formComment.approved) }}
                        {{ form_label(formComment.approved, 'Accetto la privacy policy', { 
                            'label_attr': {'class': 'contact__privacy-label' } 
                            }) }}
                    </div>
                    <div class="content__form-comments-submit">
                        {{ form_row(formComment.submit) }}
                        <p class="body-3">Per maggiori informazioni consulta la <a href="#">Privacy Policy</a></p>
                    </div>
                </div>
            {{ form_end(formComment) }}
        </div>
    {% endif %}
{% endblock %}